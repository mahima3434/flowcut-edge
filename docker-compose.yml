# ============================================================================
# FlowCut Edge â€” Docker Compose for NVIDIA Jetson
# ============================================================================
# Uses NVIDIA's jetson-containers base image for optimal Jetson performance.
# Run: docker compose up -d
# ============================================================================

services:
  flowcut-edge:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: flowcut-edge
    
    # NVIDIA GPU access
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      
      # Cosmos Video Options:
      # - "2B/post-trained": Fast, good prompt adherence (Recommended for Edge)
      # - "14B/post-trained": High quality, requires ~40GB+ VRAM (Recommended for GX10/GB10)
      # - "2B/base": Raw foundation model, less instruction following (Not recommended)
      - VIDEO_MODEL=2B/pre-trained
      
      - DEVICE=cuda
      - HF_HOME=/cache/huggingface
      - TRANSFORMERS_CACHE=/cache/huggingface/hub
    
    ports:
      - "8000:8000"
    
    volumes:
      # Persist downloaded models
      - model-cache:/cache
    
    # Restart on crash
    restart: unless-stopped
    
    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 300s  # Models take a few minutes to load

volumes:
  model-cache:
    driver: local
